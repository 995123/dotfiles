
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

    <title>Developer’s Manual &#8212; Music Player Daemon  documentation</title>
    <link rel="stylesheet" type="text/css" href="_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="_static/classic.css" />
    
    <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
    <script src="_static/jquery.js"></script>
    <script src="_static/underscore.js"></script>
    <script src="_static/doctools.js"></script>
    
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Client Developer’s Manual" href="client.html" />
    <link rel="prev" title="Plugin reference" href="plugins.html" /> 
  </head><body>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="client.html" title="Client Developer’s Manual"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="plugins.html" title="Plugin reference"
             accesskey="P">previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="index.html">Music Player Daemon  documentation</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">Developer’s Manual</a></li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <section id="developer-s-manual">
<h1>Developer’s Manual<a class="headerlink" href="#developer-s-manual" title="Permalink to this headline">¶</a></h1>
<section id="introduction">
<h2>Introduction<a class="headerlink" href="#introduction" title="Permalink to this headline">¶</a></h2>
<p>This is a guide for those who wish to hack on the MPD source code.  MPD is an open project, and we are always happy about contributions.  So far, more than 150 people have contributed patches. This document is work in progress.  Most of it may be incomplete yet.  Please help!</p>
</section>
<section id="code-style">
<h2>Code Style<a class="headerlink" href="#code-style" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li><p>indent with tabs (width 8)</p></li>
<li><p>don’t write CPP when you can write C++: use inline functions and constexpr instead of macros</p></li>
<li><p>comment your code, document your APIs</p></li>
<li><p>the code should be C++17 compliant, and must compile with <strong class="program">GCC</strong> 8 and <strong class="program">clang</strong> 5</p></li>
<li><p>all code must be exception-safe</p></li>
<li><p>classes and functions names use CamelCase; variables are lower-case with words separated by underscore</p></li>
</ul>
<p>Some example code:</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="n">Foo</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="kt">char</span><span class="w"> </span><span class="o">*</span><span class="n">abc</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">xyz</span><span class="p">)</span><span class="w"></span>
<span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">abc</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">nullptr</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">            </span><span class="n">LogWarning</span><span class="p">(</span><span class="s">&quot;Foo happened!&quot;</span><span class="p">);</span><span class="w"></span>
<span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="mi">-1</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>

<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">xyz</span><span class="p">;</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</pre></div>
</div>
<section id="error-handling">
<h3>Error handling<a class="headerlink" href="#error-handling" title="Permalink to this headline">¶</a></h3>
<p>If an error occurs, throw a C++ exception, preferably derived from
<code class="code docutils literal notranslate"><span class="pre">std::runtime_error</span></code>.  The function’s API documentation should
mention that.  If a function cannot throw exceptions, add
<code class="code docutils literal notranslate"><span class="pre">noexcept</span></code> to its prototype.</p>
<p>Some parts of MPD use callbacks to report completion; the handler
classes usually have an “error” callback which receives a
<code class="code docutils literal notranslate"><span class="pre">std::exception_ptr</span></code>
(e.g. <code class="code docutils literal notranslate"><span class="pre">BufferedSocket::OnSocketError()</span></code>).  Wrapping errors in
<code class="code docutils literal notranslate"><span class="pre">std::exception_ptr</span></code> allows propagating details about the error
across thread boundaries to the entity which is interested in handling
it (e.g. giving the MPD client details about an I/O error caught by
the decoder thread).</p>
<p>Out-of-memory errors (i.e. <code class="code docutils literal notranslate"><span class="pre">std::bad_alloc</span></code>) do not need to be
handled.  Some operating systems such as Linux do not report
out-of-memory to userspace, and instead kill a process to recover.
Even if we know we are out of memory, there is little we can do except
for aborting the process quickly.  Any other attempts to give back
memory may cause page faults on the way which make the situation
worse.</p>
<p>Error conditions which are caused by a bug do not need to be handled
at runtime; instead, use <code class="code docutils literal notranslate"><span class="pre">assert()</span></code> to detect them in debug
builds.</p>
</section>
</section>
<section id="git-branches">
<h2>git Branches<a class="headerlink" href="#git-branches" title="Permalink to this headline">¶</a></h2>
<p>There are two active branches in the git repository:</p>
<ul class="simple">
<li><p>the “unstable” branch called <code class="docutils literal notranslate"><span class="pre">master</span></code> where new features are
merged.  This will become the next major release eventually.</p></li>
<li><p>the “stable” branch (currently called <code class="docutils literal notranslate"><span class="pre">v0.22.x</span></code>) where only bug
fixes are merged.</p></li>
</ul>
<p>Once <strong class="program">MPD</strong> 0.23 is released, a new branch called <code class="docutils literal notranslate"><span class="pre">v0.23.x</span></code>
will be created for 0.23 bug-fix releases; after that, <code class="docutils literal notranslate"><span class="pre">v0.22.x</span></code>
will eventually cease to be maintained.</p>
<p>After bug fixes have been added to the “stable” branch, it will be
merged into <code class="docutils literal notranslate"><span class="pre">master</span></code>.  This ensures that all known bugs are fixed in
all active branches.</p>
</section>
<section id="hacking-the-source">
<h2>Hacking The Source<a class="headerlink" href="#hacking-the-source" title="Permalink to this headline">¶</a></h2>
<p>MPD sources are managed in a git repository on
<a class="reference external" href="https://github.com/MusicPlayerDaemon/">Github</a>.</p>
<p>Always write your code against the latest git:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>git clone git://github.com/MusicPlayerDaemon/MPD
</pre></div>
</div>
<p>If you already have a clone, update it:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>git pull --rebase git://github.com/MusicPlayerDaemon/MPD master
</pre></div>
</div>
<p>You can do without <code class="code docutils literal notranslate"><span class="pre">--rebase</span></code>, but we recommend that you rebase
your repository on the “master” repository all the time.</p>
<p>Configure with the option <code class="code docutils literal notranslate"><span class="pre">--werror</span></code>.  Enable as many plugins as
possible, to be sure that you don’t break any disabled code.</p>
<p>Don’t mix several changes in one single patch.  Create a separate patch for every change. Tools like <strong class="program">stgit</strong> help you with that. This way, we can review your patches more easily, and we can pick the patches we like most first.</p>
<section id="basic-stgit-usage">
<h3>Basic stgit usage<a class="headerlink" href="#basic-stgit-usage" title="Permalink to this headline">¶</a></h3>
<p>stgit allows you to create a set of patches and refine all of them: you can go back to any patch at any time, and re-edit it (both the code and the commit message). You can reorder patches and insert new patches at any position. It encourages creating separate patches for tiny changes.</p>
<p>stgit needs to be initialized on a git repository:</p>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span>stg init
</pre></div>
</div>
<p>Before you edit the code, create a patch:</p>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span>stg new my-patch-name
</pre></div>
</div>
<p>stgit now asks you for the commit message.</p>
<p>Now edit the code. Once you’re finished, you have to “refresh” the patch, i.e. your edits are incorporated into the patch you have created:</p>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span>stg refresh
</pre></div>
</div>
<p>You may now continue editing the same patch, and refresh it as often as you like. Create more patches, edit and refresh them.</p>
<p>To view the list of patches, type stg series. To go back to a specific patch, type stg goto my-patch-name; now you can re-edit it (don’t forget stg refresh when you’re finished with that patch).</p>
<p>When the whole patch series is finished, convert stgit patches to git commits:</p>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span>stg commit
</pre></div>
</div>
</section>
</section>
<section id="submitting-patches">
<h2>Submitting Patches<a class="headerlink" href="#submitting-patches" title="Permalink to this headline">¶</a></h2>
<p>Submit pull requests on GitHub:
<a class="reference external" href="https://github.com/MusicPlayerDaemon/MPD/pulls">https://github.com/MusicPlayerDaemon/MPD/pulls</a></p>
</section>
</section>


            <div class="clearer"></div>
          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
  <h3><a href="index.html">Table of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">Developer’s Manual</a><ul>
<li><a class="reference internal" href="#introduction">Introduction</a></li>
<li><a class="reference internal" href="#code-style">Code Style</a><ul>
<li><a class="reference internal" href="#error-handling">Error handling</a></li>
</ul>
</li>
<li><a class="reference internal" href="#git-branches">git Branches</a></li>
<li><a class="reference internal" href="#hacking-the-source">Hacking The Source</a><ul>
<li><a class="reference internal" href="#basic-stgit-usage">Basic stgit usage</a></li>
</ul>
</li>
<li><a class="reference internal" href="#submitting-patches">Submitting Patches</a></li>
</ul>
</li>
</ul>

  <h4>Previous topic</h4>
  <p class="topless"><a href="plugins.html"
                        title="previous chapter">Plugin reference</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="client.html"
                        title="next chapter">Client Developer’s Manual</a></p>
  <div role="note" aria-label="source link">
    <h3>This Page</h3>
    <ul class="this-page-menu">
      <li><a href="_sources/developer.rst.txt"
            rel="nofollow">Show Source</a></li>
    </ul>
   </div>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="client.html" title="Client Developer’s Manual"
             >next</a> |</li>
        <li class="right" >
          <a href="plugins.html" title="Plugin reference"
             >previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="index.html">Music Player Daemon  documentation</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">Developer’s Manual</a></li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &#169; Copyright 2003-2021 The Music Player Daemon Project.
      Created using <a href="https://www.sphinx-doc.org/">Sphinx</a> 4.2.0.
    </div>
  </body>
</html>